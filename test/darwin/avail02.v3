//@execute = 36
component avail02 {
	def SEEK_CUR: int = 1;
	def SEEK_END: int = 2;
	def SEEK_SET: int = 0;
	def iobuf: Array<byte> = Array.new(10);
	def main() -> int {
		var fd = Darwin.open(Pointer.atContents("test.txt\x00"), 0, 0);
		if (Darwin.read(fd, Pointer.atContents(iobuf), 10) != 10) return -2;
		return available(fd);
	}
	def available(fd: int) -> int {
		var current = Darwin.lseek(fd, (0, 0), SEEK_CUR).0;
		var end = Darwin.lseek(fd, (0, 0), SEEK_END).0;
		Darwin.lseek(fd, (current, 0), SEEK_SET);
		return end - current;
	}
}
