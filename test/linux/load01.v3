//@execute =true
component load01 {
	var statbuf: Array<int> = Array.new(32);
	def main() -> bool {
		var data = load("test.txt\x00");
		var expect = "The quick brown fox jumped over the lazy dog.\n";
		if (data.length != expect.length) return false;
		for (i = 0; i < data.length; i++) {
			if (data(i) != expect(i)) return false;
		}
		return true;
	}
	def load(fileName: string) -> Array<byte> {
		var path = Pointer.atContents(fileName);
		if (Linux.stat(path, Pointer.atContents(statbuf)) < 0) return null;
		var fd = Linux.open(path, 0, 0);
		if (fd < 0) return null;
		var buf = Array<byte>.new(statbuf(5)); // statbuf.st_size
		if (Linux.read(fd, Pointer.atContents(buf), buf.length) < 0) return null;
		Linux.close(fd);
		return buf;
	}
}
